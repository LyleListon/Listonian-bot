{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3>System Settings</h3>
    </div>
    <div class="card-body">
        <div class="card">
            <div class="card-header">
                <h4>Trading Parameters</h4>
            </div>
            <div class="card-body">
                <form id="trading-settings-form">
                    <div class="form-group">
                        <label for="max-slippage">Maximum Slippage (%)</label>
                        <input type="number" id="max-slippage" class="form-control" step="0.1" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label for="min-profit">Minimum Profit (USD)</label>
                        <input type="number" id="min-profit" class="form-control" step="0.1" min="0">
                    </div>
                    <div class="form-group">
                        <label for="gas-limit">Gas Limit</label>
                        <input type="number" id="gas-limit" class="form-control" step="1000" min="0">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Trading Settings</button>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h4>Risk Management</h4>
            </div>
            <div class="card-body">
                <form id="risk-settings-form">
                    <div class="form-group">
                        <label for="max-exposure">Maximum Exposure (ETH)</label>
                        <input type="number" id="max-exposure" class="form-control" step="0.1" min="0">
                    </div>
                    <div class="form-group">
                        <label for="max-trades">Maximum Concurrent Trades</label>
                        <input type="number" id="max-trades" class="form-control" step="1" min="1">
                    </div>
                    <div class="form-group">
                        <label for="cooldown-period">Cooldown Period (seconds)</label>
                        <input type="number" id="cooldown-period" class="form-control" step="1" min="0">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Risk Settings</button>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h4>Network Configuration</h4>
            </div>
            <div class="card-body">
                <form id="network-settings-form">
                    <div class="form-group">
                        <label for="rpc-url">RPC URL</label>
                        <input type="text" id="rpc-url" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="chain-id">Chain ID</label>
                        <input type="number" id="chain-id" class="form-control" step="1" min="1">
                    </div>
                    <div class="form-group">
                        <label for="wallet-address">Wallet Address</label>
                        <input type="text" id="wallet-address" class="form-control">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Network Settings</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Load current settings
    socket.on('settings_update', (data) => {
        if (!data) return;
        
        // Update trading settings
        document.getElementById('max-slippage').value = data.trading.max_slippage;
        document.getElementById('min-profit').value = data.trading.min_profit;
        document.getElementById('gas-limit').value = data.trading.gas_limit;
        
        // Update risk settings
        document.getElementById('max-exposure').value = data.risk.max_exposure;
        document.getElementById('max-trades').value = data.risk.max_trades;
        document.getElementById('cooldown-period').value = data.risk.cooldown_period;
        
        // Update network settings
        document.getElementById('rpc-url').value = data.network.rpc_url;
        document.getElementById('chain-id').value = data.network.chain_id;
        document.getElementById('wallet-address').value = data.network.wallet_address;
    });

    // Handle form submissions
    document.getElementById('trading-settings-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const settings = {
            max_slippage: parseFloat(document.getElementById('max-slippage').value),
            min_profit: parseFloat(document.getElementById('min-profit').value),
            gas_limit: parseInt(document.getElementById('gas-limit').value)
        };
        socket.emit('update_trading_settings', settings);
    });

    document.getElementById('risk-settings-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const settings = {
            max_exposure: parseFloat(document.getElementById('max-exposure').value),
            max_trades: parseInt(document.getElementById('max-trades').value),
            cooldown_period: parseInt(document.getElementById('cooldown-period').value)
        };
        socket.emit('update_risk_settings', settings);
    });

    document.getElementById('network-settings-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const settings = {
            rpc_url: document.getElementById('rpc-url').value,
            chain_id: parseInt(document.getElementById('chain-id').value),
            wallet_address: document.getElementById('wallet-address').value
        };
        socket.emit('update_network_settings', settings);
    });

    // Handle settings update responses
    socket.on('settings_update_response', (response) => {
        if (response.success) {
            alert('Settings updated successfully');
        } else {
            alert(`Failed to update settings: ${response.error}`);
        }
    });
</script>

<style>
.form-group {
    margin-bottom: 1rem;
}

.form-control {
    background-color: var(--card-background);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--text-color);
    padding: 0.5rem;
    border-radius: var(--border-radius);
}

.form-control:focus {
    border-color: var(--primary-color);
    outline: none;
}

.btn {
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    border: none;
    cursor: pointer;
    transition: background-color 0.2s;
}

.btn-primary {
    background-color: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background-color: #3d8b40;
}

.mt-4 {
    margin-top: 2rem;
}
</style>
{% endblock %}
