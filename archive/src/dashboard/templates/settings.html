{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-12 mb-4">
        <h2>System Settings</h2>
    </div>
</div>

<!-- Trading Settings -->
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Trading Parameters</h5>
                <form id="trading-settings">
                    <div class="mb-3">
                        <label for="min-profit" class="form-label">Minimum Profit Threshold ($)</label>
                        <input type="number" class="form-control" id="min-profit" value="{{ settings.get('min_profit_threshold', 0.5) }}" step="0.1">
                    </div>
                    <div class="mb-3">
                        <label for="max-gas" class="form-label">Maximum Gas Price (GWEI)</label>
                        <input type="number" class="form-control" id="max-gas" value="{{ settings.get('max_gas_price', 100) }}">
                    </div>
                    <div class="mb-3">
                        <label for="slippage" class="form-label">Slippage Tolerance (%)</label>
                        <input type="number" class="form-control" id="slippage" value="{{ settings.get('max_slippage', 0.5) }}" step="0.1">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Trading Settings</button>
                </form>
            </div>
        </div>
    </div>

    <!-- System Settings -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">System Configuration</h5>
                <form id="system-settings">
                    <div class="mb-3">
                        <label for="log-level" class="form-label">Log Level</label>
                        <select class="form-select" id="log-level">
                            <option value="DEBUG" {% if settings.get('log_level') == 'DEBUG' %}selected{% endif %}>Debug</option>
                            <option value="INFO" {% if settings.get('log_level') == 'INFO' %}selected{% endif %}>Info</option>
                            <option value="WARNING" {% if settings.get('log_level') == 'WARNING' %}selected{% endif %}>Warning</option>
                            <option value="ERROR" {% if settings.get('log_level') == 'ERROR' %}selected{% endif %}>Error</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="alert-email" class="form-label">Alert Email</label>
                        <input type="email" class="form-control" id="alert-email" value="{{ settings.get('alert_email', '') }}">
                    </div>
                    <div class="mb-3">
                        <label for="discord-webhook" class="form-label">Discord Webhook URL</label>
                        <input type="url" class="form-control" id="discord-webhook" value="{{ settings.get('discord_webhook_url', '') }}">
                    </div>
                    <button type="submit" class="btn btn-primary">Save System Settings</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- DEX Settings -->
<div class="row">
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">DEX Configuration</h5>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>DEX</th>
                                <th>Status</th>
                                <th>Fee Tier</th>
                                <th>Router Contract</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="dex-settings">
                            <!-- Populated by WebSocket -->
                            <tr><td colspan="5" class="text-center">Loading DEX settings...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle trading settings form submission
    document.getElementById('trading-settings').addEventListener('submit', function(e) {
        e.preventDefault();
        const settings = {
            min_profit_threshold: parseFloat(document.getElementById('min-profit').value),
            max_gas_price: parseInt(document.getElementById('max-gas').value),
            max_slippage: parseFloat(document.getElementById('slippage').value)
        };
        window.wsHandler.ws.send(JSON.stringify({
            type: 'update_settings',
            settings: settings,
            category: 'trading'
        }));
    });

    // Handle system settings form submission
    document.getElementById('system-settings').addEventListener('submit', function(e) {
        e.preventDefault();
        const settings = {
            log_level: document.getElementById('log-level').value,
            alert_email: document.getElementById('alert-email').value,
            discord_webhook_url: document.getElementById('discord-webhook').value
        };
        window.wsHandler.ws.send(JSON.stringify({
            type: 'update_settings',
            settings: settings,
            category: 'system'
        }));
    });
});
</script>
{% endblock %}
