{% extends "base.html" %}

{% block title %}System Monitor{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>System Monitor</h2>
    
    <!-- CPU Usage -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">CPU Usage</h5>
        </div>
        <div class="card-body">
            <div class="progress">
                <div id="cpu-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
            </div>
            <p class="mt-2 mb-0">CPU Usage: <span id="cpu-percent">0</span>%</p>
        </div>
    </div>

    <!-- Memory Usage -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Memory Usage</h5>
        </div>
        <div class="card-body">
            <div class="progress">
                <div id="memory-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
            </div>
            <p class="mt-2 mb-0">Memory Usage: <span id="memory-used">0</span>GB / <span id="memory-total">0</span>GB (<span id="memory-percent">0</span>%)</p>
        </div>
    </div>

    <!-- Disk Usage -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Disk Usage</h5>
        </div>
        <div class="card-body">
            <div class="progress">
                <div id="disk-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
            </div>
            <p class="mt-2 mb-0">Disk Usage: <span id="disk-used">0</span>GB / <span id="disk-total">0</span>GB (<span id="disk-percent">0</span>%)</p>
        </div>
    </div>

    <!-- Network I/O -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Network I/O</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p>Data Sent: <span id="net-sent">0</span> MB</p>
                    <p>Packets Sent: <span id="packets-sent">0</span></p>
                </div>
                <div class="col-md-6">
                    <p>Data Received: <span id="net-recv">0</span> MB</p>
                    <p>Packets Received: <span id="packets-recv">0</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Process Info -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Process Information</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p>Process CPU: <span id="process-cpu">0</span>%</p>
                    <p>Process Memory: <span id="process-memory">0</span>%</p>
                </div>
                <div class="col-md-6">
                    <p>Active Threads: <span id="process-threads">0</span></p>
                    <p>Open Files: <span id="process-files">0</span></p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        function updateProgressBarColor($bar, value) {
            if (value < 60) {
                $bar.removeClass('bg-warning bg-danger').addClass('bg-success');
            } else if (value < 80) {
                $bar.removeClass('bg-success bg-danger').addClass('bg-warning');
            } else {
                $bar.removeClass('bg-success bg-warning').addClass('bg-danger');
            }
        }

        function updateSystemStats(data) {
            // CPU
            const cpuValue = data.cpu.toFixed(1);
            $('#cpu-percent').text(cpuValue);
            $('#cpu-progress').css('width', cpuValue + '%');
            updateProgressBarColor($('#cpu-progress'), cpuValue);
            
            // Memory
            const memoryValue = data.memory.percent.toFixed(1);
            $('#memory-used').text(data.memory.used.toFixed(1));
            $('#memory-total').text(data.memory.total.toFixed(1));
            $('#memory-percent').text(memoryValue);
            $('#memory-progress').css('width', memoryValue + '%');
            updateProgressBarColor($('#memory-progress'), memoryValue);
            
            // Disk
            const diskValue = data.disk.percent.toFixed(1);
            $('#disk-used').text(data.disk.used.toFixed(1));
            $('#disk-total').text(data.disk.total.toFixed(1));
            $('#disk-percent').text(diskValue);
            $('#disk-progress').css('width', diskValue + '%');
            updateProgressBarColor($('#disk-progress'), diskValue);
            
            // Network
            $('#net-sent').text(data.network.bytes_sent.toFixed(1));
            $('#net-recv').text(data.network.bytes_recv.toFixed(1));
            $('#packets-sent').text(data.network.packets_sent);
            $('#packets-recv').text(data.network.packets_recv);
            
            // Process
            $('#process-cpu').text(data.process.cpu_percent.toFixed(1));
            $('#process-memory').text(data.process.memory_percent.toFixed(1));
            $('#process-threads').text(data.process.threads);
            $('#process-files').text(data.process.open_files);
        }

        function fetchSystemStats() {
            $.ajax({
                url: '/api/system-stats',
                method: 'GET',
                success: function(data) {
                    updateSystemStats(data);
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching system stats:', error);
                },
                complete: function() {
                    setTimeout(fetchSystemStats, 1000);
                }
            });
        }

        // Start polling
        fetchSystemStats();
    });
</script>
{% endblock %}
